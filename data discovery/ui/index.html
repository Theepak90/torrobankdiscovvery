<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Torro Data Discovery System - Enterprise Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="static/style.css" rel="stylesheet">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <img src="static/torrobackground.png" alt="Torro Logo" height="30" class="me-2">
                Torro Data Discovery System
            </a>
            <div class="navbar-nav ms-auto">
                <span class="navbar-text me-3">
                    <i class="fas fa-circle text-success me-1"></i>
                    <span id="system-status">System Online</span>
                </span>
                <button class="btn btn-outline-light btn-sm" onclick="refreshDashboard()" data-bs-toggle="tooltip" title="Refresh dashboard data">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="container-fluid mt-4">
        <!-- System Overview Cards -->
        <div class="row mb-4 animate-stagger">
            <div class="col-md-3">
                <div class="card bg-primary text-white fade-in">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <div>
                                <h2 id="total-assets" class="fw-bold mb-1">0</h2>
                                <p class="mb-0 opacity-90">Total Assets</p>
                            </div>
                            <div class="align-self-center">
                                <i class="far fa-database fa-3x"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-success text-white fade-in">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <div>
                                <h2 id="active-connectors" class="fw-bold mb-1">0</h2>
                                <p class="mb-0 opacity-90">Active Connectors</p>
                            </div>
                            <div class="align-self-center">
                                <i class="far fa-plug fa-3x"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-info text-white fade-in">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <div>
                                <h2 id="last-scan" class="fw-bold mb-1">Never</h2>
                                <p class="mb-0 opacity-90">Last Scan</p>
                            </div>
                            <div class="align-self-center">
                                <i class="far fa-clock fa-3x"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-warning text-white fade-in">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <div>
                                <h2 id="monitoring-status" class="fw-bold mb-1">Disabled</h2>
                                <p class="mb-0 opacity-90">Monitoring</p>
                            </div>
                            <div class="align-self-center">
                                <i class="far fa-eye fa-3x"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content Tabs -->
        <ul class="nav nav-tabs" id="mainTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="dashboard-tab" data-bs-toggle="tab" data-bs-target="#dashboard" type="button" role="tab">
                    <i class="fas fa-tachometer-alt me-1"></i> Dashboard
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="connectors-tab" data-bs-toggle="tab" data-bs-target="#connectors" type="button" role="tab">
                    <i class="fas fa-plug me-1"></i> Connectors
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="assets-tab" data-bs-toggle="tab" data-bs-target="#assets" type="button" role="tab">
                    <i class="fas fa-database me-1"></i> Assets
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="discovery-tab" data-bs-toggle="tab" data-bs-target="#discovery" type="button" role="tab">
                    <i class="fas fa-search me-1"></i> Discovery
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="monitoring-tab" data-bs-toggle="tab" data-bs-target="#monitoring" type="button" role="tab">
                    <i class="fas fa-eye me-1"></i> Monitoring
                </button>
            </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content mt-3" id="mainTabContent">
            <!-- Dashboard Tab -->
            <div class="tab-pane fade show active" id="dashboard" role="tabpanel">
                <div class="row">
                    <!-- System Health -->
                    <div class="col-md-6 mb-4">
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="fas fa-heartbeat me-2"></i>System Health</h5>
                            </div>
                            <div class="card-body" id="system-health">
                                <div class="d-flex justify-content-center">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Activity -->
                    <div class="col-md-6 mb-4">
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="fas fa-history me-2"></i>Recent Activity</h5>
                            </div>
                            <div class="card-body" id="recent-activity">
                                <div class="list-group list-group-flush">
                                    <div class="list-group-item">
                                        <small class="text-muted">System initialized</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Discovery Statistics -->
                    <div class="col-12 mb-4">
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="fas fa-chart-bar me-2"></i>Discovery Statistics</h5>
                            </div>
                            <div class="card-body">
                                <canvas id="discoveryChart" width="400" height="100"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Connectors Tab -->
            <div class="tab-pane fade" id="connectors" role="tabpanel">
                <div class="row mb-3">
                    <div class="col-md-6">
                        <h4>Data Connectors <span class="badge bg-secondary" id="total-connectors-badge">120+</span></h4>
                    </div>
                    <div class="col-md-6 text-end">
                        <button class="btn btn-success me-2" onclick="openNewConnectionWizard()" data-bs-toggle="tooltip" title="Create a new data connection">
                            <i class="fas fa-plus me-1"></i> New Connection
                        </button>
                        <button class="btn btn-primary" onclick="loadConnectors()" data-bs-toggle="tooltip" title="Reload connector status">
                            <i class="fas fa-sync-alt me-1"></i> Refresh Connectors
                        </button>
                    </div>
                </div>

                <!-- My Connections Section -->
                <div class="card mb-4">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-link me-2"></i> My Connections
                            <span class="badge bg-light text-dark ms-2" id="active-connections-count">0</span>
                        </h5>
                    </div>
                    <div class="card-body">
                        <div id="my-connections" class="row">
                            <div class="col-12 text-center text-muted">
                                <i class="fas fa-info-circle me-2"></i>
                                No active connections yet. Add a connection below to get started.
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Connector Categories -->
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-plug me-2"></i> Available Connectors
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="accordion" id="connectorAccordion">
                    <!-- Cloud Providers -->
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#cloudProviders">
                                <i class="fas fa-cloud me-2"></i> Cloud Providers
                            </button>
                        </h2>
                        <div id="cloudProviders" class="accordion-collapse collapse show" data-bs-parent="#connectorAccordion">
                            <div class="accordion-body">
                                <div id="cloud-connectors" class="row">
                                    <div class="text-center">
                                        <div class="spinner-border text-primary" role="status"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Databases -->
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#databases">
                                <i class="fas fa-database me-2"></i> Databases
                            </button>
                        </h2>
                        <div id="databases" class="accordion-collapse collapse" data-bs-parent="#connectorAccordion">
                            <div class="accordion-body">
                                <div id="database-connectors" class="row"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Data Warehouses -->
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#dataWarehouses">
                                <i class="fas fa-warehouse me-2"></i> Data Warehouses
                            </button>
                        </h2>
                        <div id="dataWarehouses" class="accordion-collapse collapse" data-bs-parent="#connectorAccordion">
                            <div class="accordion-body">
                                <div id="warehouse-connectors" class="row"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Network Storage -->
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#networkStorage">
                                <i class="fas fa-network-wired me-2"></i> Network Storage
                            </button>
                        </h2>
                        <div id="networkStorage" class="accordion-collapse collapse" data-bs-parent="#connectorAccordion">
                            <div class="accordion-body">
                                <div id="network-storage-connectors" class="row"></div>
                            </div>
                        </div>
                    </div>
                </div>
                    </div>
                </div>
            </div>

            <!-- Assets Tab -->
            <div class="tab-pane fade" id="assets" role="tabpanel">
                <div class="row mb-3">
                    <div class="col-md-8">
                        <div class="input-group">
                            <input type="text" class="form-control" id="asset-search" placeholder="Search assets...">
                            <button class="btn btn-outline-secondary" onclick="searchAssets()">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </div>
                    <div class="col-md-4 text-end">
                        <button class="btn btn-primary" onclick="loadAssets()" data-bs-toggle="tooltip" title="Reload discovered assets">
                            <i class="fas fa-sync-alt me-1"></i> Refresh Assets
                        </button>
                    </div>
                </div>

                <!-- Asset Filters -->
                <div class="row mb-3">
                    <div class="col-md-4">
                        <select class="form-select" id="asset-type-filter">
                            <option value="">All Asset Types</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <select class="form-select" id="asset-source-filter">
                            <option value="">All Sources</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <button class="btn btn-outline-secondary w-100" onclick="applyAssetFilters()">
                            <i class="fas fa-filter me-1"></i> Apply Filters
                        </button>
                    </div>
                </div>

                <!-- Assets Table -->
                <div class="card">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped" id="assets-table">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Type</th>
                                        <th>Source</th>
                                        <th>Size</th>
                                        <th>Created</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="assets-table-body">
                                    <tr>
                                        <td colspan="6" class="text-center">
                                            <div class="spinner-border text-primary" role="status"></div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Discovery Tab -->
            <div class="tab-pane fade" id="discovery" role="tabpanel">
                <div class="row">
                    <div class="col-md-6 mb-4">
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="fas fa-play me-2"></i>Discovery Controls</h5>
                            </div>
                            <div class="card-body">
                                <div class="d-grid gap-2">
                                    <button class="btn btn-primary btn-lg" onclick="startFullDiscovery()" data-bs-toggle="tooltip" title="Start a comprehensive discovery scan across all enabled connectors">
                                        <i class="fas fa-search me-2"></i> Start Full Discovery
                                    </button>
                                    <button class="btn btn-outline-primary" onclick="showSourceSelection()" data-bs-toggle="tooltip" title="Select specific data sources to scan">
                                        <i class="fas fa-list me-2"></i> Scan Specific Source
                                    </button>
                                </div>
                                
                                <div id="source-selection" class="mt-3" style="display: none;">
                                    <select class="form-select mb-2" id="source-select">
                                        <option value="">Select a source...</option>
                                    </select>
                                    <button class="btn btn-secondary" onclick="scanSpecificSource()">
                                        <i class="fas fa-play me-1"></i> Scan Selected Source
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6 mb-4">
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="fas fa-info-circle me-2"></i>Discovery Status</h5>
                            </div>
                            <div class="card-body" id="discovery-status">
                                <p>Status: <span class="badge bg-secondary">Idle</span></p>
                                <p>Last Scan: <span id="last-scan-time">Never</span></p>
                                <p>Active Connectors: <span id="active-connectors-count">0</span></p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Discovery Results -->
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-chart-line me-2"></i>Discovery Results</h5>
                    </div>
                    <div class="card-body">
                        <div id="discovery-results">
                            <p class="text-muted text-center">No discovery results yet. Start a discovery scan to see results.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Monitoring Tab -->
            <div class="tab-pane fade" id="monitoring" role="tabpanel">
                <div class="row">
                    <div class="col-md-6 mb-4">
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="fas fa-cog me-2"></i>Monitoring Controls</h5>
                            </div>
                            <div class="card-body">
                                <div class="form-check form-switch mb-3">
                                    <input class="form-check-input" type="checkbox" id="real-time-monitoring">
                                    <label class="form-check-label" for="real-time-monitoring">
                                        Real-time File Watching
                                    </label>
                                </div>
                                
                                <div class="d-grid gap-2">
                                    <button class="btn btn-success" onclick="startMonitoring()">
                                        <i class="fas fa-play me-2"></i> Start Monitoring
                                    </button>
                                    <button class="btn btn-danger" onclick="stopMonitoring()">
                                        <i class="fas fa-stop me-2"></i> Stop Monitoring
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6 mb-4">
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="fas fa-eye me-2"></i>Monitoring Status</h5>
                            </div>
                            <div class="card-body" id="monitoring-status-card">
                                <p>Status: <span class="badge bg-secondary">Disabled</span></p>
                                <p>Real-time Watching: <span class="badge bg-secondary">Disabled</span></p>
                                <p>Watch Interval: <span>5 seconds</span></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Enhanced Connector Configuration Modal -->
    <div class="modal fade" id="connectorModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header bg-light">
                    <div class="d-flex align-items-center">
                        <div class="connector-modal-icon me-3">
                            <i class="fas fa-plug fa-2x text-primary"></i>
                        </div>
                        <div>
                            <h4 class="modal-title mb-0">Connection Configuration</h4>
                            <small class="text-muted">Configure your data source connection</small>
                        </div>
                    </div>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-0">
                    <!-- Connection Wizard Steps -->
                    <div class="connection-wizard">
                        <!-- Step Navigation -->
                        <div class="wizard-nav bg-light border-bottom px-4 py-3">
                            <div class="row">
                                <div class="col-3">
                                    <div class="wizard-step active" data-step="1">
                                        <div class="step-number">1</div>
                                        <div class="step-title">Connection Type</div>
                                    </div>
                                </div>
                                <div class="col-3">
                                    <div class="wizard-step" data-step="2">
                                        <div class="step-number">2</div>
                                        <div class="step-title">Configuration</div>
                                    </div>
                                </div>
                                <div class="col-3">
                                    <div class="wizard-step" data-step="3">
                                        <div class="step-number">3</div>
                                        <div class="step-title">Test Connection</div>
                                    </div>
                                </div>
                                <div class="col-3">
                                    <div class="wizard-step" data-step="4">
                                        <div class="step-number">4</div>
                                        <div class="step-title">Summary</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Step Content -->
                        <div class="wizard-content p-4">
                            <!-- Step 1: Connection Type Selection -->
                            <div class="wizard-step-content active" id="step-1">
                                <h5 class="mb-4">Select Connection Type</h5>
                                <div class="row">
                                    <div class="col-md-4 mb-3">
                                        <div class="connection-type-card" data-type="database">
                                            <div class="card h-100 border-2">
                                                <div class="card-body text-center">
                                                    <div class="connection-type-icon mb-3">
                                                        <i class="fas fa-database fa-3x text-primary"></i>
                                                    </div>
                                                    <h6>Database</h6>
                                                    <p class="text-muted small">Connect to SQL databases like PostgreSQL, MySQL, Oracle</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <div class="connection-type-card" data-type="cloud">
                                            <div class="card h-100 border-2">
                                                <div class="card-body text-center">
                                                    <div class="connection-type-icon mb-3">
                                                        <i class="fas fa-cloud fa-3x text-success"></i>
                                                    </div>
                                                    <h6>Cloud Storage</h6>
                                                    <p class="text-muted small">Connect to AWS S3, Azure Blob, Google Cloud Storage</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <div class="connection-type-card" data-type="api">
                                            <div class="card h-100 border-2">
                                                <div class="card-body text-center">
                                                    <div class="connection-type-icon mb-3">
                                                        <i class="fas fa-exchange-alt fa-3x text-info"></i>
                                                    </div>
                                                    <h6>API / SaaS</h6>
                                                    <p class="text-muted small">Connect to REST APIs, Salesforce, ServiceNow</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Step 2: Configuration -->
                            <div class="wizard-step-content" id="step-2">
                                <h5 class="mb-4">Connection Configuration</h5>
                                <div id="connector-config-form">
                                    <!-- Dynamic form content will be loaded here -->
                                </div>
                            </div>

                            <!-- Step 3: Test Connection -->
                            <div class="wizard-step-content" id="step-3">
                                <h5 class="mb-4">Test Connection</h5>
                                <div class="text-center">
                                    <div id="connection-test-status">
                                        <button class="btn btn-primary btn-lg" onclick="testConnectionWizard()">
                                            <i class="fas fa-plug me-2"></i>
                                            Test Connection
                                        </button>
                                    </div>
                                    <div id="connection-test-results" class="mt-4" style="display: none;">
                                        <!-- Test results will appear here -->
                                    </div>
                                </div>
                            </div>

                            <!-- Step 4: Summary -->
                            <div class="wizard-step-content" id="step-4">
                                <h5 class="mb-4">Connection Summary</h5>
                                <div id="connection-summary">
                                    <!-- Summary will be displayed here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer bg-light">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-outline-primary" id="wizard-prev-btn" onclick="previousWizardStep()" style="display: none;">Previous</button>
                    <button type="button" class="btn btn-primary" id="wizard-next-btn" onclick="nextWizardStep()">Next</button>
                    <button type="button" class="btn btn-success" id="wizard-save-btn" onclick="saveWizardConnection()" style="display: none;">
                        <i class="fas fa-save me-2"></i>Save Connection
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Asset Details Modal -->
    <div class="modal fade" id="assetModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Asset Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="asset-modal-body">
                    <!-- Dynamic content -->
                </div>
            </div>
        </div>
    </div>

    <!-- Styles for discovered assets -->
    <style>
        .discovered-assets-list {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
        }
        
        .asset-item {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            margin: 5px 0;
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            transition: all 0.2s ease;
        }
        
        .asset-item:hover {
            background: #f8f9fa;
            border-color: #007bff;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,123,255,0.1);
        }
        
        .asset-item i {
            font-size: 16px;
            width: 20px;
        }
        
        .asset-item strong {
            flex: 1;
            margin-left: 8px;
            color: #495057;
        }
        
        .asset-item .badge {
            font-size: 0.75em;
            padding: 4px 8px;
        }
    </style>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="static/app.js?v=26.0"></script>
</body>
</html>
