<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Torro Data Discovery System - Enterprise Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <link href="static/style.css" rel="stylesheet">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <img src="static/torrobackground.png" alt="Torro Logo" height="30" class="me-2">
                Torro Data Discovery System
            </a>
            <div class="navbar-nav ms-auto">
                <span class="navbar-text me-3">
                    <i class="fas fa-dot-circle text-success me-1"></i>
                    <span id="system-status">System Online</span>
                </span>
                <button class="btn btn-outline-light btn-sm" onclick="refreshDashboard()" data-bs-toggle="tooltip" title="Refresh dashboard data">
                    <i class="fas fa-rotate"></i> Refresh
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="container-fluid mt-4">
        <!-- System Overview Cards -->
        <div class="row mb-4 animate-stagger">
            <div class="col-md-3">
                <div class="card bg-primary text-white fade-in subtle-pulse">
                    <div class="card-body">
                        <div class="d-flex align-items-center">
                            <div>
                                <h2 id="total-assets" class="fw-bold mb-1">0</h2>
                                <p class="mb-0 opacity-90">Total Assets</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-success text-white fade-in subtle-pulse">
                    <div class="card-body">
                        <div class="d-flex align-items-center">
                            <div>
                                <h2 id="active-connectors" class="fw-bold mb-1">0</h2>
                                <p class="mb-0 opacity-90">Active Connectors</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-info text-white fade-in subtle-pulse">
                    <div class="card-body">
                        <div class="d-flex align-items-center">
                            <div>
                                <h2 id="last-scan" class="fw-bold mb-1">Never</h2>
                                <p class="mb-0 opacity-90">Last Scan</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-warning text-white fade-in subtle-pulse">
                    <div class="card-body">
                        <div class="d-flex align-items-center">
                            <div>
                                <h2 id="monitoring-status" class="fw-bold mb-1">Disabled</h2>
                                <p class="mb-0 opacity-90">Monitoring</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content Tabs -->
        <ul class="nav nav-tabs" id="mainTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="dashboard-tab" data-bs-toggle="tab" data-bs-target="#dashboard" type="button" role="tab">
                    <i class="fas fa-chart-pie me-1"></i> Dashboard
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="connectors-tab" data-bs-toggle="tab" data-bs-target="#connectors" type="button" role="tab">
                    <i class="fas fa-link me-1"></i> Connectors
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="assets-tab" data-bs-toggle="tab" data-bs-target="#assets" type="button" role="tab">
                    <i class="fas fa-table me-1"></i> Assets
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="discovery-tab" data-bs-toggle="tab" data-bs-target="#discovery" type="button" role="tab">
                    <i class="fas fa-radar me-1"></i> Discovery
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="lineage-tab" data-bs-toggle="tab" data-bs-target="#lineage" type="button" role="tab">
                    <i class="fas fa-sitemap me-1"></i> Data Lineage
                </button>
            </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content mt-3" id="mainTabContent">
            <!-- Dashboard Tab -->
            <div class="tab-pane fade show active" id="dashboard" role="tabpanel">
                <div class="row">
                    <!-- System Health -->
                    <div class="col-md-6 mb-4">
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="fas fa-shield-alt me-2"></i>System Health</h5>
                            </div>
                            <div class="card-body" id="system-health">
                                <div class="d-flex justify-content-center">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Activity -->
                    <div class="col-md-6 mb-4">
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="fas fa-clock me-2"></i>Recent Activity</h5>
                            </div>
                            <div class="card-body" id="recent-activity">
                                <div class="list-group list-group-flush">
                                    <div class="list-group-item">
                                        <small class="text-muted">System initialized</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Discovery Statistics -->
                    <div class="col-12 mb-4">
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="fas fa-chart-line me-2"></i>Discovery Statistics</h5>
                            </div>
                            <div class="card-body">
                                <canvas id="discoveryChart" width="400" height="100"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Connectors Tab -->
            <div class="tab-pane fade" id="connectors" role="tabpanel">
                <div class="row mb-3">
                    <div class="col-md-6">
                        <h4>Data Connectors <span class="badge bg-secondary" id="total-connectors-badge">120+</span></h4>
                    </div>
                    <div class="col-md-6 text-end">
                        <button class="btn btn-success me-2" onclick="openNewConnectionWizard()" data-bs-toggle="tooltip" title="Create a new data connection">
                            <i class="fas fa-plus-circle me-1"></i> New Connection
                        </button>
                        <button class="btn btn-primary" onclick="loadConnectors()" data-bs-toggle="tooltip" title="Reload connector status">
                            <i class="fas fa-rotate me-1"></i> Refresh Connectors
                        </button>
                    </div>
                </div>

                <!-- My Connections Section -->
                <div class="card mb-4">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-link me-2"></i> My Connections
                            <span class="badge bg-light text-dark ms-2" id="active-connections-count">0</span>
                        </h5>
                    </div>
                    <div class="card-body">
                        <div id="my-connections" class="row">
                        </div>
                    </div>
                </div>

                <!-- Connector Categories -->
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-plug me-2"></i> Available Connectors
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="accordion" id="connectorAccordion">
                    <!-- Cloud Providers -->
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#cloudProviders">
                                <i class="fas fa-cloud-arrow-up me-2"></i> Cloud Providers
                            </button>
                        </h2>
                        <div id="cloudProviders" class="accordion-collapse collapse show" data-bs-parent="#connectorAccordion">
                            <div class="accordion-body">
                                <div id="cloud-connectors" class="row">
                                    <div class="text-center">
                                        <div class="spinner-border text-primary" role="status"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Databases -->
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#databases">
                                <i class="fas fa-database me-2"></i> Databases
                            </button>
                        </h2>
                        <div id="databases" class="accordion-collapse collapse" data-bs-parent="#connectorAccordion">
                            <div class="accordion-body">
                                <div id="database-connectors" class="row"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Data Warehouses -->
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#dataWarehouses">
                                <i class="fas fa-building me-2"></i> Data Warehouses
                            </button>
                        </h2>
                        <div id="dataWarehouses" class="accordion-collapse collapse" data-bs-parent="#connectorAccordion">
                            <div class="accordion-body">
                                <div id="warehouse-connectors" class="row"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Network Storage -->
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#networkStorage">
                                <i class="fas fa-server me-2"></i> Network Storage
                            </button>
                        </h2>
                        <div id="networkStorage" class="accordion-collapse collapse" data-bs-parent="#connectorAccordion">
                            <div class="accordion-body">
                                <div id="network-storage-connectors" class="row"></div>
                            </div>
                        </div>
                    </div>
                </div>
                    </div>
                </div>
            </div>

            <!-- Assets Tab -->
            <div class="tab-pane fade" id="assets" role="tabpanel">
                <div class="row mb-3">
                    <div class="col-md-8">
                        <div class="search-container position-relative">
                            <div class="input-group">
                                <input type="text" class="form-control" id="asset-search" placeholder="Search assets by name, type, or source..." autocomplete="off">
                                <button class="btn btn-outline-secondary" onclick="searchAssets()">
                                    <i class="fas fa-search"></i>
                                </button>
                                <button class="btn btn-outline-secondary" onclick="clearSearch()" title="Clear search">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <!-- Search Recommendations Dropdown -->
                            <div id="search-recommendations" class="search-recommendations" style="display: none;">
                                <div class="recommendations-header">
                                    <small class="text-muted">Search Suggestions</small>
                                </div>
                                <div id="recommendations-list" class="recommendations-list">
                                    <!-- Recommendations will be populated here -->
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 text-end">
                        <button class="btn btn-primary" onclick="loadAssets()" data-bs-toggle="tooltip" title="Reload discovered assets">
                            <i class="fas fa-sync-alt me-1"></i> Refresh Assets
                        </button>
                    </div>
                </div>

                <!-- Asset Filters -->
                <div class="row mb-3">
                    <div class="col-md-4">
                        <select class="form-select" id="asset-type-filter">
                            <option value="">All Asset Types</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <select class="form-select" id="asset-source-filter">
                            <option value="">All Sources</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <button class="btn btn-outline-secondary w-100" onclick="applyAssetFilters()">
                            <i class="fas fa-filter me-1"></i> Apply Filters
                        </button>
                    </div>
                </div>

                <!-- Assets Count Display -->
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5 class="mb-0">Discovered Assets</h5>
                    <span id="assets-count" class="badge bg-primary fs-6">0 assets</span>
                </div>

                <!-- Assets Table -->
                <div class="card">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped" id="assets-table">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Type</th>
                                        <th>Source</th>
                                        <th>Size</th>
                                        <th>Created</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="assets-table-body">
                                    <tr>
                                        <td colspan="6" class="text-center">
                                            <div class="spinner-border text-primary" role="status"></div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Discovery Tab -->
            <div class="tab-pane fade" id="discovery" role="tabpanel">
                <div class="row">
                    <div class="col-md-6 mb-4">
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="fas fa-play me-2"></i>Discovery Controls</h5>
                            </div>
                            <div class="card-body">
                                <div class="d-grid gap-2">
                                    <button class="btn btn-primary btn-lg" onclick="startFullDiscovery()" data-bs-toggle="tooltip" title="Start a comprehensive discovery scan across all enabled connectors">
                                        <i class="fas fa-search me-2"></i> Start Full Discovery
                                    </button>
                                    <button class="btn btn-outline-primary" onclick="showSourceSelection()" data-bs-toggle="tooltip" title="Select specific data sources to scan">
                                        <i class="fas fa-list me-2"></i> Scan Specific Source
                                    </button>
                                </div>
                                
                                <div id="source-selection" class="mt-3" style="display: none;">
                                    <select class="form-select mb-2" id="source-select">
                                        <option value="">Select a source...</option>
                                    </select>
                                    <button class="btn btn-secondary" onclick="scanSpecificSource()">
                                        <i class="fas fa-play me-1"></i> Scan Selected Source
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6 mb-4">
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="fas fa-info-circle me-2"></i>Discovery Status</h5>
                            </div>
                            <div class="card-body" id="discovery-status">
                                <p>Status: <span class="badge bg-secondary">Idle</span></p>
                                <p>Last Scan: <span id="last-scan-time">Never</span></p>
                                <p>Active Connectors: <span id="active-connectors-count">0</span></p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Discovery Results -->
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-chart-line me-2"></i>Discovery Results</h5>
                    </div>
                    <div class="card-body">
                        <div id="discovery-results">
                            <p class="text-muted text-center">No discovery results yet. Start a discovery scan to see results.</p>
                        </div>
                    </div>
                </div>
            </div>

            
            <!-- Data Lineage Tab -->
            <div class="tab-pane fade" id="lineage" role="tabpanel">
                <div class="row mb-3">
                    <div class="col-md-8">
                        <h4>Data Lineage Explorer <span class="badge bg-info" id="lineage-assets-count">0</span>
                            <small class="text-success ms-2" id="lineage-sync-status" style="display: none;">
                                <i class="fas fa-sync-alt fa-spin"></i> Syncing with Assets...
                            </small>
                        </h4>
                        <p class="text-muted">Explore data flow and dependencies with column-level lineage tracking</p>
                        <p class="text-muted small mb-0">
                            <i class="fas fa-info-circle"></i> 
                            Automatically syncs with Assets tab - new discoveries appear here instantly
                        </p>
                    </div>
                    <div class="col-md-4 text-end">
                        <button class="btn btn-success me-2" onclick="fitLineageToScreen()" data-bs-toggle="tooltip" title="Auto-fit graph to screen size">
                            <i class="fas fa-expand-arrows-alt me-1"></i> Fit to Screen
                        </button>
                        <button class="btn btn-primary me-2" onclick="refreshLineage()" data-bs-toggle="tooltip" title="Refresh lineage visualization">
                            <i class="fas fa-sync-alt me-1"></i> Refresh Lineage
                        </button>
                        <button class="btn btn-outline-secondary" onclick="exportLineage()" data-bs-toggle="tooltip" title="Export lineage data">
                            <i class="fas fa-download me-1"></i> Export
                        </button>
                    </div>
                </div>

                <!-- Asset Selection -->
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="fas fa-search me-2"></i>Asset Selection</h5>
                            </div>
                            <div class="card-body">
                                <div class="input-group mb-3">
                                    <input type="text" class="form-control" id="lineage-asset-search" placeholder="Search assets for lineage...">
                                    <button class="btn btn-outline-secondary" onclick="searchLineageAssets()">
                                        <i class="fas fa-search"></i>
                                    </button>
                                </div>
                                <select class="form-select mb-3" id="lineage-asset-select" onchange="selectAssetForLineage()">
                                    <option value="">Select an asset to view its lineage...</option>
                                </select>
                                <div class="d-flex gap-2">
                                    <select class="form-select" id="lineage-direction">
                                        <option value="both">Upstream & Downstream</option>
                                        <option value="upstream">Upstream Only</option>
                                        <option value="downstream">Downstream Only</option>
                                    </select>
                                    <select class="form-select" id="lineage-depth">
                                        <option value="3">3 Levels</option>
                                        <option value="2">2 Levels</option>
                                        <option value="1">1 Level</option>
                                        <option value="5">5 Levels</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="fas fa-info-circle me-2"></i>Lineage Summary</h5>
                            </div>
                            <div class="card-body" id="lineage-summary">
                                <div class="text-center text-muted py-3">
                                    <i class="fas fa-project-diagram fa-3x mb-3 opacity-50"></i>
                                    <p>Select an asset to view its lineage summary</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Lineage Relationship Management -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">
                                    <i class="fas fa-edit me-2"></i>Manage Relationships
                                </h5>
                                <div class="btn-group" role="group">
                                    <button class="btn btn-outline-primary btn-sm" id="toggle-edit-mode" onclick="toggleLineageEditMode()">
                                        <i class="fas fa-edit me-1"></i>Edit Mode
                                    </button>
                                    <button class="btn btn-outline-success btn-sm" onclick="addNewRelationship()">
                                        <i class="fas fa-plus me-1"></i>Add Relationship
                                    </button>
                                    <button class="btn btn-outline-info btn-sm" onclick="showRelationshipList()">
                                        <i class="fas fa-list me-1"></i>View All
                                    </button>
                                </div>
                            </div>
                            <div class="card-body" id="relationship-management-body">
                                <!-- Edit Mode Instructions -->
                                <div id="edit-mode-instructions" style="display: none;">
                                    <div class="alert alert-info">
                                        <h6><i class="fas fa-info-circle me-2"></i>Edit Mode Active</h6>
                                        <p class="mb-2">You can now create relationships between assets:</p>
                                        <ul class="mb-0">
                                            <li><strong>Click</strong> on a source node to select it</li>
                                            <li><strong>Click</strong> on a target node to create a relationship</li>
                                            <li><strong>Right-click</strong> on an edge to delete a relationship</li>
                                            <li>Use the controls below to specify relationship details</li>
                                        </ul>
                                    </div>
                                </div>

                                <!-- Relationship Form -->
                                <div id="relationship-form" style="display: none;">
                                    <div class="row">
                                        <div class="col-md-4">
                                            <label class="form-label">Source Asset</label>
                                            <select class="form-select" id="source-asset-select">
                                                <option value="">Select source asset...</option>
                                            </select>
                                        </div>
                                        <div class="col-md-4">
                                            <label class="form-label">Target Asset</label>
                                            <select class="form-select" id="target-asset-select">
                                                <option value="">Select target asset...</option>
                                            </select>
                                        </div>
                                        <div class="col-md-4">
                                            <label class="form-label">Relationship Type</label>
                                            <select class="form-select" id="relationship-type">
                                                <option value="feeds_into">Feeds Into</option>
                                                <option value="derived_from">Derived From</option>
                                                <option value="transforms_to">Transforms To</option>
                                                <option value="aggregates_to">Aggregates To</option>
                                                <option value="joins_with">Joins With</option>
                                                <option value="custom">Custom</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row mt-3">
                                        <div class="col-md-6">
                                            <label class="form-label">Confidence Level</label>
                                            <input type="range" class="form-range" id="confidence-level" min="0" max="1" step="0.1" value="0.9">
                                            <small class="text-muted">Confidence: <span id="confidence-display">0.9</span></small>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">Description (Optional)</label>
                                            <input type="text" class="form-control" id="relationship-description" placeholder="Describe this relationship...">
                                        </div>
                                    </div>
                                    <div class="row mt-3">
                                        <div class="col-12">
                                            <button class="btn btn-success me-2" onclick="saveRelationship()">
                                                <i class="fas fa-save me-1"></i>Save Relationship
                                            </button>
                                            <button class="btn btn-secondary" onclick="cancelRelationship()">
                                                <i class="fas fa-times me-1"></i>Cancel
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <!-- Default State -->
                                <div id="relationship-default-state">
                                    <div class="text-center text-muted py-4">
                                        <i class="fas fa-project-diagram fa-3x mb-3 opacity-25"></i>
                                        <h5>Relationship Management</h5>
                                        <p>Use the buttons above to add custom upstream and downstream relationships between your data assets.</p>
                                        <div class="mt-3">
                                            <small class="text-muted">
                                                <i class="fas fa-lightbulb me-1"></i>
                                                Tip: Enable Edit Mode to visually connect nodes in the graph below
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Lineage Visualization -->
                <div class="card mb-4">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="fas fa-sitemap me-2"></i>Lineage Visualization
                        </h5>
                        <div class="btn-group" role="group">
                            <input type="radio" class="btn-check" name="lineage-view" id="graph-view" autocomplete="off" checked onchange="switchLineageView('graph')">
                            <label class="btn btn-outline-primary btn-sm" for="graph-view">
                                <i class="fas fa-project-diagram me-1"></i>Graph
                            </label>
                            <input type="radio" class="btn-check" name="lineage-view" id="table-view" autocomplete="off" onchange="switchLineageView('table')">
                            <label class="btn btn-outline-primary btn-sm" for="table-view">
                                <i class="fas fa-table me-1"></i>Table
                            </label>
                        </div>
                    </div>
                    <div class="card-body">
                        <!-- Graph View -->
                        <div id="lineage-graph-view">
                            <div id="lineage-graph" style="height: 500px; border: 1px solid #dee2e6; border-radius: 8px;">
                                <div class="d-flex align-items-center justify-content-center h-100 text-muted">
                                    <div class="text-center">
                                        <i class="fas fa-project-diagram fa-4x mb-3 opacity-25"></i>
                                        <h5>No Asset Selected</h5>
                                        <p>Select an asset from the dropdown above to view its data lineage</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Table View -->
                        <div id="lineage-table-view" style="display: none;">
                            <div class="table-responsive">
                                <table class="table table-striped" id="lineage-table">
                                    <thead>
                                        <tr>
                                            <th>Asset</th>
                                            <th>Type</th>
                                            <th>Source</th>
                                            <th>Direction</th>
                                            <th>Level</th>
                                            <th>Columns</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="lineage-table-body">
                                        <tr>
                                            <td colspan="7" class="text-center text-muted py-4">
                                                No lineage data available. Select an asset to view its lineage.
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Lineage Analysis Panel -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5><i class="fas fa-analytics me-2"></i>Lineage Analysis</h5>
                    </div>
                    <div class="card-body">
                        <!-- Analysis Tabs -->
                        <ul class="nav nav-tabs" id="analysisTab" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="overview-tab" data-bs-toggle="tab" data-bs-target="#overview" type="button" role="tab">
                                    Overview
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="transformations-tab" data-bs-toggle="tab" data-bs-target="#transformations" type="button" role="tab">
                                    Transformations
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="architecture-tab" data-bs-toggle="tab" data-bs-target="#architecture" type="button" role="tab">
                                    Architecture
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="code-analysis-tab" data-bs-toggle="tab" data-bs-target="#code-analysis" type="button" role="tab">
                                    Code Analysis
                                </button>
                            </li>
                        </ul>

                        <!-- Tab Content -->
                        <div class="tab-content mt-3" id="analysisTabContent">
                            <!-- Overview Tab -->
                            <div class="tab-pane fade show active" id="overview" role="tabpanel">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="card border-primary">
                                            <div class="card-header bg-primary text-white">
                                                <h6 class="mb-0"><i class="fas fa-info-circle me-2"></i>Lineage Summary</h6>
                                            </div>
                                            <div class="card-body" id="overview-summary">
                                                <div class="text-center text-muted py-3">
                                                    <i class="fas fa-project-diagram fa-2x mb-2"></i>
                                                    <p>Select an asset to view lineage overview</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card border-info">
                                            <div class="card-header bg-info text-white">
                                                <h6 class="mb-0"><i class="fas fa-chart-pie me-2"></i>Asset Statistics</h6>
                                            </div>
                                            <div class="card-body" id="overview-stats">
                                                <div class="row text-center">
                                                    <div class="col-4">
                                                        <h4 class="text-primary mb-0" id="stat-upstream">0</h4>
                                                        <small class="text-muted">Upstream</small>
                                                    </div>
                                                    <div class="col-4">
                                                        <h4 class="text-success mb-0" id="stat-current">0</h4>
                                                        <small class="text-muted">Current</small>
                                                    </div>
                                                    <div class="col-4">
                                                        <h4 class="text-info mb-0" id="stat-downstream">0</h4>
                                                        <small class="text-muted">Downstream</small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row mt-3">
                                    <div class="col-12">
                                        <div class="card border-success">
                                            <div class="card-header bg-success text-white">
                                                <h6 class="mb-0"><i class="fas fa-timeline me-2"></i>Data Flow Timeline</h6>
                                            </div>
                                            <div class="card-body" id="overview-timeline">
                                                <div class="timeline-container">
                                                    <div class="text-center text-muted py-3">
                                                        <i class="fas fa-clock fa-2x mb-2"></i>
                                                        <p>Timeline will appear when asset is selected</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Transformations Tab -->
                            <div class="tab-pane fade" id="transformations" role="tabpanel">
                                <div class="row">
                                    <div class="col-md-8">
                                        <div class="card">
                                            <div class="card-header">
                                                <h6><i class="fas fa-exchange-alt me-2"></i>Data Transformations</h6>
                                            </div>
                                            <div class="card-body" id="transformations-list">
                                                <div class="text-center text-muted py-4">
                                                    <i class="fas fa-cogs fa-3x mb-3"></i>
                                                    <p>Select an asset to view its transformations</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="card">
                                            <div class="card-header">
                                                <h6><i class="fas fa-chart-bar me-2"></i>Transformation Types</h6>
                                            </div>
                                            <div class="card-body" id="transformation-types">
                                                <canvas id="transformationChart" width="300" height="200"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Architecture Tab -->
                            <div class="tab-pane fade" id="architecture" role="tabpanel">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-header">
                                                <h6><i class="fas fa-sitemap me-2"></i>System Architecture</h6>
                                            </div>
                                            <div class="card-body" id="architecture-diagram">
                                                <div class="architecture-view">
                                                    <div class="text-center text-muted py-4">
                                                        <i class="fas fa-building fa-3x mb-3"></i>
                                                        <p>Architecture diagram will be generated based on lineage</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-header">
                                                <h6><i class="fas fa-layer-group me-2"></i>Data Layers</h6>
                                            </div>
                                            <div class="card-body" id="data-layers">
                                                <div class="layer-list">
                                                    <div class="text-center text-muted py-4">
                                                        <i class="fas fa-stack fa-3x mb-3"></i>
                                                        <p>Data layer analysis will appear here</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Code Analysis Tab -->
                            <div class="tab-pane fade" id="code-analysis" role="tabpanel">
                                <div class="row">
                                    <div class="col-md-8">
                                        <div class="card">
                                            <div class="card-header">
                                                <h6><i class="fas fa-code me-2"></i>Generated Code Analysis</h6>
                                            </div>
                                            <div class="card-body" id="code-analysis-content">
                                                <div class="code-analysis-container">
                                                    <div class="text-center text-muted py-4">
                                                        <i class="fas fa-file-code fa-3x mb-3"></i>
                                                        <p>Code analysis will be generated based on lineage patterns</p>
                                                        <button class="btn btn-primary mt-2" onclick="generateCodeAnalysis()">
                                                            <i class="fas fa-play me-1"></i>Generate Analysis
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="card">
                                            <div class="card-header">
                                                <h6><i class="fas fa-bug me-2"></i>Quality Metrics</h6>
                                            </div>
                                            <div class="card-body" id="quality-metrics">
                                                <div class="metrics-list">
                                                    <div class="metric-item mb-2">
                                                        <div class="d-flex justify-content-between">
                                                            <span>Complexity Score</span>
                                                            <span class="badge bg-warning" id="complexity-score">-</span>
                                                        </div>
                                                    </div>
                                                    <div class="metric-item mb-2">
                                                        <div class="d-flex justify-content-between">
                                                            <span>Data Quality</span>
                                                            <span class="badge bg-success" id="data-quality">-</span>
                                                        </div>
                                                    </div>
                                                    <div class="metric-item mb-2">
                                                        <div class="d-flex justify-content-between">
                                                            <span>Performance</span>
                                                            <span class="badge bg-info" id="performance-score">-</span>
                                                        </div>
                                                    </div>
                                                    <div class="metric-item mb-2">
                                                        <div class="d-flex justify-content-between">
                                                            <span>Maintainability</span>
                                                            <span class="badge bg-primary" id="maintainability">-</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Column-Level Lineage -->
                <div class="card" id="column-lineage-card" style="display: none;">
                    <div class="card-header">
                        <h5><i class="fas fa-columns me-2"></i>Column-Level Lineage</h5>
                        <small class="text-muted">Detailed column-to-column relationships and transformations</small>
                    </div>
                    <div class="card-body">
                        <!-- Column Lineage Controls -->
                        <div class="row mb-3">
                            <div class="col-md-8">
                                <div class="d-flex align-items-center">
                                    <div class="me-3">
                                        <label class="form-label mb-0">Selected Asset:</label>
                                        <span class="badge bg-primary ms-2" id="column-lineage-asset-name">None</span>
                                    </div>
                                    <div class="me-3">
                                        <label class="form-label mb-0">Columns:</label>
                                        <span class="badge bg-info ms-2" id="column-lineage-column-count">0</span>
                                    </div>
                                    <div>
                                        <label class="form-label mb-0">Relationships:</label>
                                        <span class="badge bg-success ms-2" id="column-lineage-relationship-count">0</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4 text-end">
                                <button class="btn btn-success btn-sm me-2" onclick="refreshColumnLineage()" data-bs-toggle="tooltip" title="Refresh column lineage data">
                                    <i class="fas fa-sync-alt me-1"></i> Refresh
                                </button>
                                <div class="btn-group" role="group">
                                    <button class="btn btn-outline-primary btn-sm active" id="column-view-detailed" onclick="switchColumnView('detailed')">
                                        <i class="fas fa-list me-1"></i> Detailed
                                    </button>
                                    <button class="btn btn-outline-primary btn-sm" id="column-view-matrix" onclick="switchColumnView('matrix')">
                                        <i class="fas fa-table me-1"></i> Matrix
                                    </button>
                                    <button class="btn btn-outline-primary btn-sm" id="column-view-flow" onclick="switchColumnView('flow')">
                                        <i class="fas fa-project-diagram me-1"></i> Flow
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Column Lineage Content -->
                        <div id="column-lineage-content">
                            <!-- Default Empty State -->
                            <div id="column-lineage-empty" class="text-center text-muted py-5">
                                <i class="fas fa-columns fa-4x mb-3 opacity-25"></i>
                                <h5>No Column Data Available</h5>
                                <p>Select an asset from the lineage graph above to view detailed column relationships</p>
                                <div class="mt-3">
                                    <small class="text-muted">
                                        <i class="fas fa-info-circle me-1"></i>
                                        Column lineage shows upstream sources, downstream targets, and transformations for each column
                                    </small>
                                </div>
                            </div>

                            <!-- Detailed View -->
                            <div id="column-lineage-detailed" style="display: none;">
                                <div class="row" id="column-lineage-cards">
                                    <!-- Column cards will be populated here -->
                                </div>
                            </div>

                            <!-- Matrix View -->
                            <div id="column-lineage-matrix" style="display: none;">
                                <div class="table-responsive">
                                    <table class="table table-bordered table-hover">
                                        <thead class="table-dark">
                                            <tr>
                                                <th>Column</th>
                                                <th>Type</th>
                                                <th>Upstream Sources</th>
                                                <th>Downstream Targets</th>
                                                <th>Transformations</th>
                                                <th>Confidence</th>
                                            </tr>
                                        </thead>
                                        <tbody id="column-lineage-matrix-body">
                                            <!-- Matrix rows will be populated here -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <!-- Flow View -->
                            <div id="column-lineage-flow" style="display: none;">
                                <div class="column-flow-container">
                                    <div class="row">
                                        <div class="col-md-3">
                                            <div class="card border-success">
                                                <div class="card-header bg-success text-white">
                                                    <h6 class="mb-0"><i class="fas fa-arrow-left me-2"></i>Upstream Sources</h6>
                                                </div>
                                                <div class="card-body p-2" id="column-flow-upstream">
                                                    <!-- Upstream columns -->
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="card border-primary">
                                                <div class="card-header bg-primary text-white">
                                                    <h6 class="mb-0"><i class="fas fa-database me-2"></i>Current Asset Columns</h6>
                                                </div>
                                                <div class="card-body p-2" id="column-flow-current">
                                                    <!-- Current asset columns -->
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="card border-info">
                                                <div class="card-header bg-info text-white">
                                                    <h6 class="mb-0"><i class="fas fa-arrow-right me-2"></i>Downstream Targets</h6>
                                                </div>
                                                <div class="card-body p-2" id="column-flow-downstream">
                                                    <!-- Downstream columns -->
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Enhanced Connector Configuration Modal -->
    <div class="modal fade" id="connectorModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header bg-light">
                    <div class="d-flex align-items-center">
                        <div class="connector-modal-icon me-3">
                            <i class="fas fa-plug fa-2x text-primary"></i>
                        </div>
                        <div>
                            <h4 class="modal-title mb-0">Connection Configuration</h4>
                            <small class="text-muted">Configure your data source connection</small>
                        </div>
                    </div>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-0">
                    <!-- Connection Wizard Steps -->
                    <div class="connection-wizard">
                        <!-- Step Navigation -->
                        <div class="wizard-nav bg-light border-bottom px-4 py-3">
                            <div class="row">
                                <div class="col-3">
                                    <div class="wizard-step active" data-step="1">
                                        <div class="step-number">1</div>
                                        <div class="step-title">Connection Type</div>
                                    </div>
                                </div>
                                <div class="col-3">
                                    <div class="wizard-step" data-step="2">
                                        <div class="step-number">2</div>
                                        <div class="step-title">Configuration</div>
                                    </div>
                                </div>
                                <div class="col-3">
                                    <div class="wizard-step" data-step="3">
                                        <div class="step-number">3</div>
                                        <div class="step-title">Test Connection</div>
                                    </div>
                                </div>
                                <div class="col-3">
                                    <div class="wizard-step" data-step="4">
                                        <div class="step-number">4</div>
                                        <div class="step-title">Summary</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Step Content -->
                        <div class="wizard-content p-4">
                            <!-- Step 1: Connection Type Selection -->
                            <div class="wizard-step-content active" id="step-1">
                                <h5 class="mb-4">Select Connection Type</h5>
                                <div class="row">
                                    <div class="col-md-4 mb-3">
                                        <div class="connection-type-card" data-type="database">
                                            <div class="card h-100 border-2">
                                                <div class="card-body text-center">
                                                    <div class="connection-type-icon mb-3">
                                                        <i class="fas fa-database fa-3x text-primary"></i>
                                                    </div>
                                                    <h6>Database</h6>
                                                    <p class="text-muted small">Connect to SQL databases like PostgreSQL, MySQL, Oracle</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <div class="connection-type-card" data-type="cloud">
                                            <div class="card h-100 border-2">
                                                <div class="card-body text-center">
                                                    <div class="connection-type-icon mb-3">
                                                        <i class="fas fa-cloud fa-3x text-success"></i>
                                                    </div>
                                                    <h6>Cloud Storage</h6>
                                                    <p class="text-muted small">Connect to Azure Blob, Google Cloud Storage</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <div class="connection-type-card" data-type="api">
                                            <div class="card h-100 border-2">
                                                <div class="card-body text-center">
                                                    <div class="connection-type-icon mb-3">
                                                        <i class="fas fa-exchange-alt fa-3x text-info"></i>
                                                    </div>
                                                    <h6>API / SaaS</h6>
                                                    <p class="text-muted small">Connect to REST APIs, Salesforce, ServiceNow</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Step 2: Configuration -->
                            <div class="wizard-step-content" id="step-2">
                                <h5 class="mb-4">Connection Configuration</h5>
                                <div id="connector-config-form">
                                    <!-- Dynamic form content will be loaded here -->
                                </div>
                            </div>

                            <!-- Step 3: Test Connection -->
                            <div class="wizard-step-content" id="step-3">
                                <h5 class="mb-4">Test Connection</h5>
                                <div class="text-center">
                                    <div id="connection-test-status">
                                        <button class="btn btn-primary btn-lg" onclick="testConnectionWizard()">
                                            <i class="fas fa-plug me-2"></i>
                                            Test Connection
                                        </button>
                                    </div>
                                    <div id="connection-test-results" class="mt-4" style="display: none;">
                                        <!-- Test results will appear here -->
                                    </div>
                                </div>
                            </div>

                            <!-- Step 4: Summary -->
                            <div class="wizard-step-content" id="step-4">
                                <h5 class="mb-4">Connection Summary</h5>
                                <div id="connection-summary">
                                    <!-- Summary will be displayed here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer bg-light">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-outline-primary" id="wizard-prev-btn" onclick="previousWizardStep()" style="display: none;">Previous</button>
                    <button type="button" class="btn btn-primary" id="wizard-next-btn" onclick="nextWizardStep()">Next</button>
                    <button type="button" class="btn btn-success" id="wizard-save-btn" onclick="saveWizardConnection()" style="display: none;">
                        <i class="fas fa-save me-2"></i>Save Connection
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Asset Details Modal -->
    <div class="modal fade" id="assetModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="asset-modal-title">Asset Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <!-- Asset Details Tabs -->
                    <ul class="nav nav-tabs" id="assetDetailsTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="asset-overview-tab" data-bs-toggle="tab" data-bs-target="#asset-overview" type="button" role="tab">
                                <i class="fas fa-info-circle me-1"></i> Overview
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="asset-schema-tab" data-bs-toggle="tab" data-bs-target="#asset-schema" type="button" role="tab">
                                <i class="fas fa-table me-1"></i> Schema
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="asset-profiling-tab" data-bs-toggle="tab" data-bs-target="#asset-profiling" type="button" role="tab">
                                <i class="fas fa-chart-bar me-1"></i> Data Profiling
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="asset-ai-analysis-tab" data-bs-toggle="tab" data-bs-target="#asset-ai-analysis" type="button" role="tab">
                                <i class="fas fa-brain me-1"></i> AI Analysis
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="asset-pii-scan-tab" data-bs-toggle="tab" data-bs-target="#asset-pii-scan" type="button" role="tab">
                                <i class="fas fa-shield-alt me-1"></i> PII Scan
                            </button>
                        </li>
                    </ul>
                    
                    <!-- Tab Content -->
                    <div class="tab-content mt-3" id="assetDetailsTabContent">
                        <!-- Overview Tab -->
                        <div class="tab-pane fade show active" id="asset-overview" role="tabpanel">
                            <div id="asset-overview-content">
                                <!-- Dynamic overview content -->
                            </div>
                        </div>
                        
                        <!-- Schema Tab -->
                        <div class="tab-pane fade" id="asset-schema" role="tabpanel">
                            <div id="asset-schema-content">
                                <!-- Dynamic schema content -->
                            </div>
                        </div>
                        
                        <!-- Data Profiling Tab -->
                        <div class="tab-pane fade" id="asset-profiling" role="tabpanel">
                            <div id="asset-profiling-content">
                                <div class="text-center py-4">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">Loading profiling data...</span>
                                    </div>
                                    <p class="mt-2 text-muted">Analyzing data...</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- AI Analysis Tab -->
                        <div class="tab-pane fade" id="asset-ai-analysis" role="tabpanel">
                            <div id="asset-ai-analysis-content">
                                <div class="text-center py-4">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">Loading AI analysis...</span>
                                    </div>
                                    <p class="mt-2 text-muted">Performing AI analysis with Gemini...</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- PII Scan Tab -->
                        <div class="tab-pane fade" id="asset-pii-scan" role="tabpanel">
                            <div id="asset-pii-scan-content">
                                <div class="text-center py-4">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">Scanning for PII...</span>
                                    </div>
                                    <p class="mt-2 text-muted">Scanning for personally identifiable information...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Styles for discovered assets -->
    <style>
        .discovered-assets-list {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
        }
        
        .asset-item {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            margin: 5px 0;
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            transition: all 0.2s ease;
        }
        
        .asset-item:hover {
            background: #f8f9fa;
            border-color: #007bff;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,123,255,0.1);
        }
        
        .asset-item i {
            font-size: 16px;
            width: 20px;
        }
        
        .asset-item strong {
            flex: 1;
            margin-left: 8px;
            color: #495057;
        }
        
        .asset-item .badge {
            font-size: 0.75em;
            padding: 4px 8px;
        }
    </style>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="static/app.js?v=29.0"></script>
</body>
</html>
